!function(){"use strict";angular.module("app",["app.core","app.admin","app.main","app.place","app.auth","app.user"]),angular.module("app").run(["$rootScope","$location",function(e,r){e.$on("$routeChangeError",function(e,t,o,a){"not authorized"===a&&r.path("/")})}])}(),function(){"use strict";angular.module("app.admin",[])}(),function(){"use strict";angular.module("app.auth",[])}(),function(){"use strict";angular.module("app.core",["ngAnimate","ngRoute","ngSanitize","ngResource","ngCookies","blocks.exception","blocks.logger","blocks.router"])}(),function(){"use strict";angular.module("app.main",[])}(),function(){"use strict";angular.module("app.place",[])}(),function(){"use strict";angular.module("app.user",[])}(),function(){"use strict";angular.module("blocks.exception",["blocks.logger"])}(),function(){"use strict";angular.module("blocks.logger",[])}(),function(){"use strict";angular.module("blocks.router",["ngRoute","blocks.logger"])}(),function(){"use strict";angular.module("app.admin").run(["routehelper",function(e){var r=[{url:"/admin/users",config:{templateUrl:"/app/admin/user-list.html",controller:"mvAdminUserListCtrl",resolve:e.routeRoleChecks.admin}}];e.configureRoutes(r)}])}(),function(){"use strict";angular.module("app.admin").controller("mvAdminUserListCtrl",["$scope","mvUser",function(e,r){e.users=r.query(function(){console.log("scope users: "+e.users.length)})}])}(),function(){"use strict";angular.module("app.auth").run(["routehelper",function(e){var r=[{url:"/signup",config:{templateUrl:"/app/auth/form-signup.html",controller:"mvSignupCtrl"}},{url:"/profile",config:{templateUrl:"/app/auth/form-profile.html",controller:"mvProfileCtrl",resolve:e.routeRoleChecks.user}}];e.configureRoutes(r)}])}(),function(){"use strict";angular.module("app.auth").factory("mvAuth",["$http","$q","$cookieStore","$rootScope","mvIdentity","mvUser",function(e,r,t,o,a,n){return{createUser:function(e){var t=new n(e),o=r.defer();return t.$save().then(function(){a.currentUser=t,o.resolve()},function(e){o.reject(e.data.reason)}),o.promise},updateCurrentUser:function(e){var t=r.defer(),o=angular.copy(a.currentUser);return angular.extend(o,e),o.$update().then(function(){a.currentUser=o,t.resolve()},function(e){t.reject(e.data.reason)}),t.promise},authenticateUser:function(o,l){var i=r.defer();return e.post("/login",{username:o,password:l}).then(function(e){if(e.data.success){var r=new n;angular.extend(r,e.data.user),a.currentUser=r;var o=a.currentUser;t.put("bootstrappedUser",o),i.resolve(!0)}else i.resolve(!1)}),i.promise},logoutUser:function(){var t=r.defer();return e.post("/logout",{logout:!0}).then(function(){a.currentUser=void 0,t.resolve()}),t.promise},authorizeCurrentUserForRoute:function(e){return a.isAuthorized(e)?!0:r.reject("not authorized")},authorizeAuthenticatedUserForRoute:function(){return a.isAuthenticated()?!0:r.reject("Not authorized")}}}])}(),function(){"use strict";angular.module("app.auth").factory("mvIdentity",["$window","$cookieStore","mvUser",function(e,r,t){var o;return r.get("bootstrappedUser")&&(o=new t,angular.extend(o,r.get("bootstrappedUser"))),{currentUser:o,isAuthenticated:function(){return!!this.currentUser},isAuthorized:function(e){return!!this.currentUser&&this.currentUser.roles.indexOf(e)>-1}}}])}(),function(){"use strict";angular.module("app.auth").controller("mvLoginCtrl",["$scope","$http","$cookieStore","mvIdentity","logger","mvAuth","$location",function(e,r,t,o,a,n,l){e.identity=o,e.signin=function(e,r){n.authenticateUser(e,r).then(function(e){e?a.info("You have successfully signed in!"):a.warning("Username/password combination incorrent")})},e.signout=function(){n.logoutUser().then(function(){t.remove("bootstrappedUser"),e.username="",e.password="",a.info("You have successfully signed out!"),l.path("/")})}}])}(),function(){"use strict";angular.module("app.auth").controller("mvProfileCtrl",["$scope","mvAuth","mvIdentity","logger",function(e,r,t,o){e.email=t.currentUser.username,e.firstName=t.currentUser.firstName,e.lastName=t.currentUser.lastName,e.update=function(){var t={username:e.email,firstName:e.firstName,lastName:e.lastName};e.password&&e.password.length>0&&(t.password=e.password),r.updateCurrentUser(t).then(function(){o.info("Your user account has been updated")},function(e){o.error(e)})}}])}(),function(){"use strict";angular.module("app.auth").controller("mvSignupCtrl",["$scope","mvAuth","logger","$location",function(e,r,t,o){e.signup=function(){var a={username:e.email,password:e.password,firstName:e.firstName,lastName:e.lastName};r.createUser(a).then(function(){t.info("New user created!"),o.path("/")},function(e){t.error(e)})}}])}(),function(){"use strict";var e=angular.module("app.core");e.config(["toastr",function(e){e.options.timeOut=4e3,e.options.positionClass="toast-bottom-right"}]);var r={appErrorPrefix:"[black squid Error]",appTitle:"black squid",version:"1.0.0"};e.value("config",r),e.config(["$logProvider","$routeProvider","$locationProvider","routehelperConfigProvider","exceptionHandlerProvider",function(e,t,o,a,n){e.debugEnabled&&e.debugEnabled(!0),o.html5Mode({enabled:!0,requireBase:!1}),a.config.$routeProvider=t,a.config.docTitle="black squid";var l={};a.config.resolveAlways=l,n.configure(r.appErrorPrefix)}])}(),function(){"use strict";angular.module("app.core").constant("toastr",toastr).constant("moment",moment)}(),function(){"use strict";angular.module("app.main").run(["routehelper",function(e){var r=[{url:"/",config:{templateUrl:"/app/main/content-main.html",controller:"mvMainCtrl"}}];e.configureRoutes(r)}])}(),function(){"use strict";angular.module("app.main").controller("mvMainCtrl",["$scope","mvCachedPlace",function(e,r){e.places=r.query()}])}(),function(){"use strict";angular.module("app.place").run(["routehelper",function(e){var r=[{url:"/places",config:{templateUrl:"/app/place/place-list.html",controller:"mvPlaceListCtrl"}},{url:"/places/:id",config:{templateUrl:"/app/place/place-detail.html",controller:"mvPlaceDetailCtrl"}}];e.configureRoutes(r)}])}(),function(){"use strict";angular.module("app.place").factory("mvCachedPlace",["mvPlace",function(e){var r;return{query:function(){return r||(r=e.query()),r}}}])}(),function(){"use strict";angular.module("app.place").factory("mvPlace",["$resource",function(e){var r=e("/api/places/:_id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return r}])}(),function(){"use strict";angular.module("app.place").controller("mvPlaceDetailCtrl",["$scope","mvCachedPlace","$routeParams",function(e,r,t){r.query().$promise.then(function(r){r.forEach(function(r){r._id===t.id&&(e.place=r)})})}])}(),function(){"use strict";angular.module("app.place").controller("mvPlaceListCtrl",["$scope","mvCachedPlace",function(e,r){e.places=r.query(),e.sortOptions=[{value:"title",text:"Sort by Title"},{value:"published",text:"Sort by publish data"}],e.sortOrder=e.sortOptions[0].value}])}(),function(){"use strict";angular.module("app.user").factory("mvUser",["$resource",function(e){var r=e("/api/users/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return r.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},r}])}(),function(){"use strict";angular.module("app").value("mvToastr",toastr),angular.module("app").factory("mvNotifier",function(e){return{notify:function(r){e.success(r),console.log(r)},error:function(r){e.error(r),console.log(r)}}})}(),function(){"use strict";angular.module("blocks.exception").provider("exceptionHandler",[function(){var e=this;e.config={appErrorPrefix:void 0},e.configure=function(e){this.config.appErrorPrefix=e},e.$get=function(){return{config:this.config}}}]).config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate","exceptionHandler","logger",function(e,r,t){return function(o,a){var n=r.config.appErrorPrefix||"",l={exception:o,cause:a};o.message=n+o.message,e(o,a),t.error(o.message,l)}}])}])}(),function(){"use strict";angular.module("blocks.exception").factory("exception",["logger",function(e){function r(r){return function(t){e.error(r,t)}}var t={catcher:r};return t}])}(),function(){"use strict";angular.module("blocks.logger").factory("logger",["$log","toastr",function(e,r){function t(t,o,a){r.error(t,a),e.error("Error: "+t,o)}function o(t,o,a){r.info(t,a),e.info("Info: "+t,o)}function a(t,o,a){r.success(t,a),e.success("Success: "+t,o)}function n(t,o,a){r.warning(t,a),e.warn("Warning: "+t,o)}var l={showToasts:!0,error:t,info:o,success:a,warning:n,log:e.log};return l}])}(),function(){"use strict";angular.module("blocks.router").provider("routehelperConfig",[function(){this.config={},this.$get=function(){return{config:this.config}}}]).factory("routehelper",["$location","$rootScope","$route","logger","routehelperConfig","mvAuth",function(e,r,t,o,a,n){function l(e){e.forEach(function(e){e.config.resolve=angular.extend(e.config.resolve||{},a.config.resolveAlways),f.when(e.url,e.config)}),f.otherwise({redirectTo:"/"})}function i(){r.$on("$routeChangeError",function(r,t,a,n){if(!d){p.errors++,d=!0;var l=t&&(t.title||t.name||t.loadedTemplateUrl)||"unknown target",i="Error routing to "+l+". "+(n.msg||"");o.warning(i,[t]),e.path("/")}})}function s(){i(),u()}function c(){for(var e in t.routes)if(t.routes.hasOwnProperty(e)){var r=t.routes[e],o=!!r.title;o&&m.push(r)}return m}function u(){r.$on("$routeChangeSuccess",function(e,t,o){p.changes++,d=!1;var n=a.config.docTitle+" "+(t.title||"");r.title=n})}var d=!1,p={errors:0,changes:0},m=[],f=a.config.$routeProvider,g={admin:{auth:["mvAuth",function(e){return e.authorizeCurrentUserForRoute("admin")}]},user:{auth:["mvAuth",function(e){return e.authorizeAuthenticatedUserForRoute()}]}},v={routeRoleChecks:g,configureRoutes:l,getRoutes:c,routeCounts:p};return s(),v}])}(),angular.module("app.core").run(["$templateCache",function(e){e.put("/app/admin/user-list.html","<div class=container><h1>User List</h1><table class=table><tr ng-repeat=\"user in users\"><td>{{user.firstName + ' ' + user.lastName}}</td></tr></table></div>"),e.put("/app/auth/form-login.html",'<div ng-controller=mvLoginCtrl class=navbar-right><form ng-hide=identity.isAuthenticated() class=navbar-form><div class=form-group><input placeholder=Email ng-model=username class=form-control></div><div class=form-group><input type=password placeholder=Password ng-model=password class=form-control></div><button ng-click="signin(username, password)" class="btn btn-primary">Signin</button>&nbsp;<a href=/signup class="btn btn-default">Sign up</a></form><ul ng-show=identity.isAuthenticated() class="nav navbar-nav navbar-right"><li class=dropdown><a href data-toggle=dropdown class=dropdown-toggle>{{ identity.currentUser.firstName + " " + identity.currentUser.lastName }}<b class=caret></b></a><ul class=dropdown-menu><li ng-show=identity.currentUser.isAdmin()><a href=/admin/users>User Admin</a></li><li><a href=/profile>Profile</a></li><li><a href ng-click=signout()>Sign Out</a></li></ul></li></ul></div>'),e.put("/app/auth/form-profile.html",'<div class=container><div class=well><form name=profileForm class=form-horizontal><fieldset><legend>User Profile<div class=form-group><label for=email class="col-md-2 control-label">Email</label><div class=col-md-10><input name=email type=email placeholder=Email ng-model=email required class=form-control></div></div><div class=form-group><label for=firstName class="col-md-2 control-label">First Name</label><div class=col-md-10><input name=firstName type=firstName placeholder="First Name" ng-model=firstName required class=form-control></div></div><div class=form-group><label for=lastName class="col-md-2 control-label">Last Name</label><div class=col-md-10><input name=lastName type=lastName placeholder="Last Name" ng-model=lastName required class=form-control></div></div><div class=form-group><label for=password class="col-md-2 control-label">Password</label><div class=col-md-10><input name=password type=password placeholder=Password ng-model=password class=form-control></div></div><div class=form-group><div class="col-md-10 col-md-offset-2"><div class=pull-right><button ng-click=update() ng-disable=profileForm.invalid class="btn btn-primary">Submit</button><a href="/" class="btn btn-default">Cancel</a></div></div></div></legend></fieldset></form></div></div>'),e.put("/app/auth/form-signup.html",'<div class=container><div class=well><form name=signupForm class=form-horizontal><fieldset><legend>New User Information<div class=form-group><label for=email class="col-md-2 control-label">Email</label><div class=col-md-10><input name=email type=email placeholder=Email ng-model=email required class=form-control></div></div><div class=form-group><label for=password class="col-md-2 control-label">Password</label><div class=col-md-10><input name=password type=password placeholder=Password ng-model=password required class=form-control></div></div><div class=form-group><label for=firstName class="col-md-2 control-label">First Name</label><div class=col-md-10><input name=firstName type=firstName placeholder="First Name" ng-model=firstName required class=form-control></div></div><div class=form-group><label for=lastName class="col-md-2 control-label">Last Name</label><div class=col-md-10><input name=lastName type=lastName placeholder="Last Name" ng-model=lastName required class=form-control></div></div><div class=form-group><div class="col-md-10 col-md-offset-2"><div class=pull-right><button ng-click=signup() ng-disable=signupForm.invalid class="btn btn-primary">Submit</button><a href="/" class="btn btn-default">Cancel</a></div></div></div></legend></fieldset></form></div></div>'),e.put("/app/main/content-main.html","<div class=container><div class=jumbotron><h1>Example</h1></div><div class=row><div class=col-md-12><div ng-include=\"'/app/main/panel-featured-place.html'\"></div></div></div><div class=row><div class=col-md-12><div ng-include=\"'/app/main/panel-new-place.html'\"></div></div></div></div>"),e.put("/app/main/panel-featured-place.html",'<div class="panel panel-primary"><div class="panel-heading text-center">Featured places</div><div class=panel-body><div ng-repeat="place in places | filter:{featured:true}" class=row><div class=col-md-12><a href="/places/{{ place._id }}">{{ place.title }}</a></div></div></div></div>'),e.put("/app/main/panel-new-place.html",'<div class="panel panel-primary"><div class="panel-heading text-center">New places</div><div class=panel-body><div ng-repeat="place in places | filter:{order_by:published} | limitTo:10" class=row><div class=col-md-3>{{place.published | date:\'MMM d\'}}</div><div class=col-md-9><a href="/places/{{ place._id }}">{{ place.title }}</a></div></div></div></div>'),e.put("/app/place/place-detail.html",'<div class=container><h1>{{ place.title }}</h1><div class=row><div class=col-md-6><h3 ng-show=place.featured>Featured</h3><h3>Published on {{ place.published | date }}</h3></div><div class=col-md-6><div class="panel panel-primary"><div class=panel-heading>Tags</div><div class=panel-body><div ng-repeat="tag in place.tags">{{tag}}</div></div></div></div></div></div>'),e.put("/app/place/place-list.html",'<div class=container><div class=pull-right><form class=form-inline><div class=form-group><input ng-model=searchText placeholder=Search class=form-control></div><div class=form-group><select ng-model=sortOrder ng-options="item.value as item.text for item in sortOptions" class=form-control></select></div></form></div><table class="table table-hover table-stripped table-condensed"><thead><tr><th>Title</th><th>Publish Date</th></tr></thead><tbody><tr ng-repeat="place in places | filter:searchText | orderBy: sortOrder"><td><a href="/places/{{ place._id }}">{{ place.title }}</a></td><td>{{ place.published | date }}</td></tr></tbody></table></div>')}]);