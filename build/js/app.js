!function(){"use strict";angular.module("app",["app.core","app.admin","app.main","app.place","app.auth","app.user"]),angular.module("app").run(["$rootScope","$location",function(e,r){e.$on("$routeChangeError",function(e,t,a,o){"not authorized"===o&&r.path("/")})}])}(),function(){"use strict";angular.module("app.admin",[])}(),function(){"use strict";angular.module("app.auth",[])}(),function(){"use strict";angular.module("app.core",["ngAnimate","ngRoute","ngSanitize","ngResource","ngCookies","blocks.exception","blocks.logger","blocks.router"])}(),function(){"use strict";angular.module("app.main",[])}(),function(){"use strict";angular.module("app.place",[])}(),function(){"use strict";angular.module("app.user",[])}(),function(){"use strict";angular.module("blocks.logger",[])}(),function(){"use strict";angular.module("blocks.exception",["blocks.logger"])}(),function(){"use strict";angular.module("blocks.router",["ngRoute","blocks.logger"])}(),function(){"use strict";function e(e){var r=[{url:"/admin/users",config:{templateUrl:"/app/admin/user-list.html",controller:"mvAdminUserListCtrl",resolve:e.routeRoleChecks.admin}}];e.configureRoutes(r)}angular.module("app.admin").run(e),e.$inject=["routehelper"]}(),function(){"use strict";function e(e,r){e.users=r.query(function(){console.log("scope users: "+e.users.length)})}angular.module("app.admin").controller("mvAdminUserListCtrl",e),e.$inject=["$scope","mvUser"]}(),function(){"use strict";function e(e){var r=[{url:"/signup",config:{templateUrl:"/app/auth/form-signup.html",controller:"mvSignupCtrl"}},{url:"/profile",config:{templateUrl:"/app/auth/form-profile.html",controller:"mvProfileCtrl",resolve:e.routeRoleChecks.user}}];e.configureRoutes(r)}angular.module("app.auth").run(e),e.$inject=["routehelper"]}(),function(){"use strict";function e(e,r,t,a,o,n){return{createUser:function(e){var t=new n(e),a=r.defer();return t.$save().then(function(){o.currentUser=t,a.resolve()},function(e){a.reject(e.data.reason)}),a.promise},updateCurrentUser:function(e){var t=r.defer(),a=angular.copy(o.currentUser);return angular.extend(a,e),a.$update().then(function(){o.currentUser=a,t.resolve()},function(e){t.reject(e.data.reason)}),t.promise},authenticateUser:function(a,i){var l=r.defer();return e.post("/login",{username:a,password:i}).then(function(e){if(e.data.success){var r=new n;angular.extend(r,e.data.user),o.currentUser=r;var a=o.currentUser;t.put("bootstrappedUser",a),l.resolve(!0)}else l.resolve(!1)}),l.promise},logoutUser:function(){var t=r.defer();return e.post("/logout",{logout:!0}).then(function(){o.currentUser=void 0,t.resolve()}),t.promise},authorizeCurrentUserForRoute:function(e){return o.isAuthorized(e)?!0:r.reject("not authorized")},authorizeAuthenticatedUserForRoute:function(){return o.isAuthenticated()?!0:r.reject("Not authorized")}}}angular.module("app.auth").factory("mvAuth",e),e.$inject=["$http","$q","$cookieStore","$rootScope","mvIdentity","mvUser"]}(),function(){"use strict";function e(e,r,t){var a;return r.get("bootstrappedUser")&&(a=new t,angular.extend(a,r.get("bootstrappedUser"))),{currentUser:a,isAuthenticated:function(){return!!this.currentUser},isAuthorized:function(e){return!!this.currentUser&&this.currentUser.roles.indexOf(e)>-1}}}angular.module("app.auth").factory("mvIdentity",e),e.$inject=["$window","$cookieStore","mvUser"]}(),function(){"use strict";function e(e,r,t,a,o,n,i){e.identity=a,e.signin=function(e,r){n.authenticateUser(e,r).then(function(e){e?o.info("You have successfully signed in!"):o.warning("Username/password combination incorrent")})},e.signout=function(){n.logoutUser().then(function(){t.remove("bootstrappedUser"),e.username="",e.password="",o.info("You have successfully signed out!"),i.path("/")})}}angular.module("app.auth").controller("mvLoginCtrl",e),e.$inject=["$scope","$http","$cookieStore","mvIdentity","logger","mvAuth","$location"]}(),function(){"use strict";function e(e,r,t,a){e.email=t.currentUser.username,e.firstName=t.currentUser.firstName,e.lastName=t.currentUser.lastName,e.update=function(){var t={username:e.email,firstName:e.firstName,lastName:e.lastName};e.password&&e.password.length>0&&(t.password=e.password),r.updateCurrentUser(t).then(function(){a.info("Your user account has been updated")},function(e){a.error(e)})}}angular.module("app.auth").controller("mvProfileCtrl",e),e.$inject=["$scope","mvAuth","mvIdentity","logger"]}(),function(){"use strict";function e(e,r,t,a){e.signup=function(){var o={username:e.email,password:e.password,firstName:e.firstName,lastName:e.lastName};r.createUser(o).then(function(){t.info("New user created!"),a.path("/")},function(e){t.error(e)})}}angular.module("app.auth").controller("mvSignupCtrl",e),e.$inject=["$scope","mvAuth","logger","$location"]}(),function(){"use strict";function e(e,r,a,o,n){e.debugEnabled&&e.debugEnabled(!0),a.html5Mode({enabled:!0,requireBase:!1}),o.config.$routeProvider=r,o.config.docTitle="black squid";var i={};o.config.resolveAlways=i,n.configure(t.appErrorPrefix)}function r(e){e.options.timeOut=4e3,e.options.positionClass="toast-bottom-right"}var t={appErrorPrefix:"[BLACK SQUID ERROR]",appTitle:"black squid",version:"1.0.0"},a=angular.module("app.core");a.config(r),a.value("config",t),a.config(e),e.$inject=["$logProvider","$routeProvider","$locationProvider","routehelperConfigProvider","exceptionHandlerProvider"],r.$inject=["toastr"]}(),function(){"use strict";angular.module("app.core").constant("toastr",toastr).constant("moment",moment)}(),function(){"use strict";function e(e){var r=[{url:"/",config:{templateUrl:"/app/main/content-main.html",controller:"mvMainCtrl"}}];e.configureRoutes(r)}angular.module("app.main").run(e),e.$inject=["routehelper"]}(),function(){"use strict";function e(e,r){e.places=r.query()}angular.module("app.main").controller("mvMainCtrl",e),e.$inject=["$scope","mvCachedPlace"]}(),function(){"use strict";function e(e){var r=[{url:"/places",config:{templateUrl:"/app/place/place-list.html",controller:"mvPlaceListCtrl"}},{url:"/places/:id",config:{templateUrl:"/app/place/place-detail.html",controller:"mvPlaceDetailCtrl"}}];e.configureRoutes(r)}angular.module("app.place").run(e),e.$inject=["routehelper"]}(),function(){"use strict";function e(e){var r;return{query:function(){return r||(r=e.query()),r}}}angular.module("app.place").factory("mvCachedPlace",e),e.$inject=["mvPlace"]}(),function(){"use strict";function e(e){var r=e("/api/places/:_id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return r}angular.module("app.place").factory("mvPlace",e),e.$inject=["$resource"]}(),function(){"use strict";function e(e,r,t){r.query().$promise.then(function(r){r.forEach(function(r){r._id===t.id&&(e.place=r)})})}angular.module("app.place").controller("mvPlaceDetailCtrl",e),e.$inject=["$scope","mvCachedPlace","$routeParams"]}(),function(){"use strict";function e(e,r){e.places=r.query(),e.sortOptions=[{value:"title",text:"Sort by Title"},{value:"published",text:"Sort by publish data"}],e.sortOrder=e.sortOptions[0].value}angular.module("app.place").controller("mvPlaceListCtrl",e),e.$inject=["$scope","mvCachedPlace"]}(),function(){"use strict";function e(e){var r=e("/api/users/:id",{_id:"@id"},{update:{method:"PUT",isArray:!1}});return r.prototype.isAdmin=function(){return this.roles&&this.roles.indexOf("admin")>-1},r}angular.module("app.user").factory("mvUser",e),e.$inject=["$resource"]}(),function(){"use strict";function e(e,r){function t(t,a,o){r.error(t,o),e.error("Error: "+t,a)}function a(t,a,o){r.info(t,o),e.info("Info: "+t,a)}function o(t,a,o){r.success(t,o),e.success("Success: "+t,a)}function n(t,a,o){r.warning(t,o),e.warn("Warning: "+t,a)}var i={showToasts:!0,error:t,info:a,success:o,warning:n,log:e.log};return i}angular.module("blocks.logger").factory("logger",e),e.$inject=["$log","toastr"]}(),function(){"use strict";function e(){this.config={appErrorPrefix:void 0},this.configure=function(e){this.config.appErrorPrefix=e},this.$get=function(){return{config:this.config}}}function r(e){function r(e,r,t){return function(a,o){var n=r.config.appErrorPrefix||"",i={exception:a,cause:o};a.message=n+a.message,e(a,o),t.error(a.message,i)}}e.decorator("$exceptionHandler",r),r.$inject=["$delegate","exceptionHandler","logger"]}angular.module("blocks.exception").provider("exceptionHandler",e).config(r),r.$inject=["$provide"]}(),function(){"use strict";function e(e){function r(r){return function(t){e.error(r,t)}}var t={catcher:r};return t}angular.module("blocks.exception").factory("exception",e),e.$inject=["logger"]}(),function(){"use strict";function e(){this.config={},this.$get=function(){return{config:this.config}}}function r(e,r,t,a,o,n){function i(e){e.forEach(function(e){e.config.resolve=angular.extend(e.config.resolve||{},o.config.resolveAlways),f.when(e.url,e.config)}),f.otherwise({redirectTo:"/"})}function l(){r.$on("$routeChangeError",function(r,t,o,n){if(!d){p.errors++,d=!0;var i=t&&(t.title||t.name||t.loadedTemplateUrl)||"unknown target",l="Error routing to "+i+". "+(n.msg||"");a.warning(l,[t]),e.path("/")}})}function s(){l(),u()}function c(){for(var e in t.routes)if(t.routes.hasOwnProperty(e)){var r=t.routes[e],a=!!r.title;a&&m.push(r)}return m}function u(){r.$on("$routeChangeSuccess",function(e,t,a){p.changes++,d=!1;var n=o.config.docTitle+" "+(t.title||"");r.title=n})}var d=!1,p={errors:0,changes:0},m=[],f=o.config.$routeProvider,g={admin:{auth:["mvAuth",function(e){return e.authorizeCurrentUserForRoute("admin")}]},user:{auth:["mvAuth",function(e){return e.authorizeAuthenticatedUserForRoute()}]}},v={routeRoleChecks:g,configureRoutes:i,getRoutes:c,routeCounts:p};return s(),v}angular.module("blocks.router").provider("routehelperConfig",e).factory("routehelper",r),r.$inject=["$location","$rootScope","$route","logger","routehelperConfig","mvAuth"]}(),angular.module("app.core").run(["$templateCache",function(e){e.put("/app/admin/user-list.html","<div class=container><h1>User List</h1><table class=table><tr ng-repeat=\"user in users\"><td>{{user.firstName + ' ' + user.lastName}}</td></tr></table></div>"),e.put("/app/auth/form-login.html",'<div ng-controller=mvLoginCtrl class=navbar-right><form ng-hide=identity.isAuthenticated() class=navbar-form><div class=form-group><input placeholder=Email ng-model=username class=form-control></div><div class=form-group><input type=password placeholder=Password ng-model=password class=form-control></div><button ng-click="signin(username, password)" class="btn btn-primary">Signin</button>&nbsp;<a href=/signup class="btn btn-default">Sign up</a></form><ul ng-show=identity.isAuthenticated() class="nav navbar-nav navbar-right"><li class=dropdown><a href data-toggle=dropdown class=dropdown-toggle>{{ identity.currentUser.firstName + " " + identity.currentUser.lastName }}<b class=caret></b></a><ul class=dropdown-menu><li ng-show=identity.currentUser.isAdmin()><a href=/admin/users>User Admin</a></li><li><a href=/profile>Profile</a></li><li><a href ng-click=signout()>Sign Out</a></li></ul></li></ul></div>'),e.put("/app/auth/form-profile.html",'<div class=container><div class=well><form name=profileForm class=form-horizontal><fieldset><legend>User Profile<div class=form-group><label for=email class="col-md-2 control-label">Email</label><div class=col-md-10><input name=email type=email placeholder=Email ng-model=email required class=form-control></div></div><div class=form-group><label for=firstName class="col-md-2 control-label">First Name</label><div class=col-md-10><input name=firstName type=firstName placeholder="First Name" ng-model=firstName required class=form-control></div></div><div class=form-group><label for=lastName class="col-md-2 control-label">Last Name</label><div class=col-md-10><input name=lastName type=lastName placeholder="Last Name" ng-model=lastName required class=form-control></div></div><div class=form-group><label for=password class="col-md-2 control-label">Password</label><div class=col-md-10><input name=password type=password placeholder=Password ng-model=password class=form-control></div></div><div class=form-group><div class="col-md-10 col-md-offset-2"><div class=pull-right><button ng-click=update() ng-disable=profileForm.invalid class="btn btn-primary">Submit</button><a href="/" class="btn btn-default">Cancel</a></div></div></div></legend></fieldset></form></div></div>'),e.put("/app/auth/form-signup.html",'<div class=container><div class=well><form name=signupForm class=form-horizontal><fieldset><legend>New User Information<div class=form-group><label for=email class="col-md-2 control-label">Email</label><div class=col-md-10><input name=email type=email placeholder=Email ng-model=email required class=form-control></div></div><div class=form-group><label for=password class="col-md-2 control-label">Password</label><div class=col-md-10><input name=password type=password placeholder=Password ng-model=password required class=form-control></div></div><div class=form-group><label for=firstName class="col-md-2 control-label">First Name</label><div class=col-md-10><input name=firstName type=firstName placeholder="First Name" ng-model=firstName required class=form-control></div></div><div class=form-group><label for=lastName class="col-md-2 control-label">Last Name</label><div class=col-md-10><input name=lastName type=lastName placeholder="Last Name" ng-model=lastName required class=form-control></div></div><div class=form-group><div class="col-md-10 col-md-offset-2"><div class=pull-right><button ng-click=signup() ng-disable=signupForm.invalid class="btn btn-primary">Submit</button><a href="/" class="btn btn-default">Cancel</a></div></div></div></legend></fieldset></form></div></div>'),e.put("/app/main/content-main.html","<div class=container><div class=jumbotron><h1>Example</h1></div><div class=row><div class=col-md-12><div ng-include=\"'/app/main/panel-featured-place.html'\"></div></div></div><div class=row><div class=col-md-12><div ng-include=\"'/app/main/panel-new-place.html'\"></div></div></div></div>"),e.put("/app/main/panel-featured-place.html",'<div class="panel panel-primary"><div class="panel-heading text-center">Featured places</div><div class=panel-body><div ng-repeat="place in places | filter:{featured:true}" class=row><div class=col-md-12><a href="/places/{{ place._id }}">{{ place.title }}</a></div></div></div></div>'),e.put("/app/main/panel-new-place.html",'<div class="panel panel-primary"><div class="panel-heading text-center">New places</div><div class=panel-body><div ng-repeat="place in places | filter:{order_by:published} | limitTo:10" class=row><div class=col-md-3>{{place.published | date:\'MMM d\'}}</div><div class=col-md-9><a href="/places/{{ place._id }}">{{ place.title }}</a></div></div></div></div>'),e.put("/app/place/place-detail.html",'<div class=container><h1>{{ place.title }}</h1><div class=row><div class=col-md-6><h3 ng-show=place.featured>Featured</h3><h3>Published on {{ place.published | date }}</h3></div><div class=col-md-6><div class="panel panel-primary"><div class=panel-heading>Tags</div><div class=panel-body><div ng-repeat="tag in place.tags">{{tag}}</div></div></div></div></div></div>'),e.put("/app/place/place-list.html",'<div class=container><div class=pull-right><form class=form-inline><div class=form-group><input ng-model=searchText placeholder=Search class=form-control></div><div class=form-group><select ng-model=sortOrder ng-options="item.value as item.text for item in sortOptions" class=form-control></select></div></form></div><table class="table table-hover table-stripped table-condensed"><thead><tr><th>Title</th><th>Publish Date</th></tr></thead><tbody><tr ng-repeat="place in places | filter:searchText | orderBy: sortOrder"><td><a href="/places/{{ place._id }}">{{ place.title }}</a></td><td>{{ place.published | date }}</td></tr></tbody></table></div>')}]);