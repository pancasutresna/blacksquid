(function() {
    'use strict';

    angular
        .module('app.data')
        .factory('model-metadata', metadata);

    metadata.$inject = ['breeze'];

    function metadata(breeze) {
        // 'Identity' is the default key generation strategy for this app
        var keyGen = breeze.AutoGeneratedKeyType.Identity;
        // namespace of the corresponding classes on the server
        var namespace = 'CC.Model'; //TODO: Need to change this 

        // Breeze Labs: breeze.metadata.helper.js
        // https://github.com/IdeaBlade/Breeze/blob/master/Breeze.Client/Scripts/Labs/breeze.metadata-helper.js
        // The helper reduces data entry by applying common conventions
        // and converting common abbreviations (e.g., 'type' -> 'dataType')
        var helper = new breeze.config.MetadataHelper(namespace, keyGen);

        /*** Convenience fns and vars ***/
        var store; // the metadata that we'll be building

        // addType - make it easy to add the type to the store using the helper
        var addType = function(type) {
            helper.addTypeToStore(store, type);
        };

        // DataTypes
        var DT = breeze.DataType;
        var BOOL = DT.Boolean;
        var DATE = DT.DateTime;
        var ID = DT.Int32;

        return {
            fillMetadataStore: fillMetadataStore
        };

        /**** IMPLEMENTATION DETAILS ***/

        function fillMetadataStore(metadataStore) {
            store = metadataStore;

            // Add types in alphabetical order ... because we can
            addPerson();
            addPlace();
        }

        // TODO: We'll come back to this
        function addPerson() {
            addType({
                name: 'Person',
                dataProperties: {
                    id: {type: ID},
                    firstName: {max: 50, nullOk: false},
                    lastName: {max: 50, nullOk: false},
                    // could add validators here; let model.validation add them
                    email: {max: 400},
                    blog: {max: 400},
                    twitter: {max: 400},
                    gender: {max: 1},
                    imageSource: {max: 400},
                },
                navigationProperties: {
                 }
            });
        }

        // TODO: We'll come back to this
        function addPlace() {
            addType({
                name: 'Place',
                dataProperties: {
                    id: {type: ID},
                    name: {max: 50, nullOk: false}
                }
            });
        }
    }

})();
